<h1>Adnat</h1>

<h2><%= current_user.organisation.name %></h2>

<h3>Shifts</h3>

  <table border="2" id="shift_table">
    <tr>
      <th>Employee Name</th>
      <th>Shift Date</th>
      <th>Start Time</th>
      <th>Finish Time</th>
      <th>Break Length (minutes)</th>
      <th>Hours Worked</th>
      <th>Shift Cost</th>
    </tr>
    <tr ></tr>
     <% @shifts.each do |shift| %>
    <tr>
      <td><%= shift.employee_name %></td>
      <td><%= shift.start&.strftime("%m/ %d/ %y") %></td>
      <td><%= shift.start&.strftime("%I:%M %p") %></td>
      <td><%= shift.finish&.strftime("%I:%M %p") %></td>
      <td><%= shift.break_length %></td>
      <td><%= shift.hours_worked %></td>
      <td><%= shift.cost %></td>
    </tr>
    <% end %>

    <tr id="shift_row">
      <%= form_tag "/shifts", id: 'shift_form' do %>
        <td><%= text_field_tag :employee_name, current_user.name %></td>
        <td><%= date_field_tag :start_date, nil, required: true %></td>
        <td><%= time_field_tag :start_time, nil, required: true %></td>
        <td><%= time_field_tag :finish, nil, required: true %></td>
        <td><%= number_field_tag :break_length, nil, required: true %></td>
        <td colspan="2"><%= submit_tag %></td>
      <% end %>
    </tr>
  </table>

<script type="text/javascript">
  $("#shift_form").submit(function(){
    $.ajax({
      url: "/shifts",
      method: "POST",
      data: {
        employee_name: $("#employee_name").val(),
        start_date: $("#start_date").val(),
        start_time: $("#start_time").val(),
        finish: $("#finish").val(),
        break_length: $("#break_length").val(),

      },
      success: function(result){
        $(
          "<tr><td>"+result.employee_name+
          "</td><td>"+result.start_date+
          "</td><td>"+result.start_time+
          "</td><td>"+result.finish+
          "</td><td>"+result.break_length+
          "</td><td>"+result.hours_worked+
          "</td><td>"+result.cost+
          "</td></tr>"
        ).insertBefore($("#shift_row"))
      }
    });
    return false;
  });
</script>